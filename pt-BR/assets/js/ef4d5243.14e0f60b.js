/*! For license information please see ef4d5243.14e0f60b.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2656],{984:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>h});const o=JSON.parse('{"id":"documentation/helpers/shared-resources","title":"\ud83e\udea2 Recursos Compartilhados","description":"<History","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/documentation/helpers/shared-resources.mdx","sourceDirName":"documentation/helpers","slug":"/documentation/helpers/shared-resources","permalink":"/pt-BR/docs/documentation/helpers/shared-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/wellwelwel/poku/tree/main/website/docs/documentation/helpers/shared-resources.mdx","tags":[{"inline":true,"label":"shared","permalink":"/pt-BR/docs/tags/shared"},{"inline":true,"label":"state","permalink":"/pt-BR/docs/tags/state"},{"inline":true,"label":"resources","permalink":"/pt-BR/docs/tags/resources"},{"inline":true,"label":"e2e","permalink":"/pt-BR/docs/tags/e-2-e"},{"inline":true,"label":"integration","permalink":"/pt-BR/docs/tags/integration"}],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["shared","state","resources","e2e","integration"]},"sidebar":"docs","previous":{"title":"\ud83c\udf0c only","permalink":"/pt-BR/docs/documentation/helpers/only"},"next":{"title":"\ud83d\uddc4\ufe0f List Files","permalink":"/pt-BR/docs/documentation/helpers/list-files"}}');var a=r(74848),n=r(28453),t=r(38215),c=r(42467);const i={sidebar_position:11,tags:["shared","state","resources","e2e","integration"]},d="\ud83e\udea2 Recursos Compartilhados",l={},h=[{value:"O que s\xe3o Recursos Compartilhados?",id:"o-que-s\xe3o-recursos-compartilhados",level:2},{value:"Uso B\xe1sico",id:"uso-b\xe1sico",level:2},{value:"1. Defina um Recurso Compartilhado",id:"1-defina-um-recurso-compartilhado",level:3},{value:"2. Acesse o Recurso Compartilhado nos Testes",id:"2-acesse-o-recurso-compartilhado-nos-testes",level:3},{value:"3. M\xe9todos se Tornam Chamadas de Procedimento Remoto",id:"3-m\xe9todos-se-tornam-chamadas-de-procedimento-remoto",level:3},{value:"4. Desanexando o Recurso",id:"4-desanexando-o-recurso",level:3},{value:"5. L\xf3gica de Limpeza",id:"5-l\xf3gica-de-limpeza",level:3},{value:"Exemplos do Mundo Real",id:"exemplos-do-mundo-real",level:2},{value:"1. Cache LRU Compartilhado (<code>lru.min</code>)",id:"1-cache-lru-compartilhado-lrumin",level:3},{value:"2. Conex\xe3o MySQL Compartilhada (<code>mysql2</code>)",id:"2-conex\xe3o-mysql-compartilhada-mysql2",level:3}];function u(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"-recursos-compartilhados",children:"\ud83e\udea2 Recursos Compartilhados"})}),"\n",(0,a.jsx)(t.B,{records:[{version:"3.0.3-canary.60ff5ce2",changes:[(0,a.jsx)(a.Fragment,{children:"Introduce Shared Resources."})]}]}),"\n",(0,a.jsx)(c.k,{level:1}),"\n",(0,a.jsx)(s.p,{children:"Compartilhe estado e m\xe9todos entre arquivos e processos de teste, permitindo padr\xf5es avan\xe7ados de integra\xe7\xe3o e testes end-to-end."}),"\n",(0,a.jsx)(s.h2,{id:"o-que-s\xe3o-recursos-compartilhados",children:"O que s\xe3o Recursos Compartilhados?"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Recursos Compartilhados"})," permitem que voc\xea defina um recurso (objeto, estado ou API) em um \xfanico arquivo e acesse ou altere esse recurso a partir de m\xfaltiplos arquivos ou processos de teste. Isso \xe9 \xfatil para cen\xe1rios como:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Compartilhar uma conex\xe3o de banco de dados ou armazenamento em mem\xf3ria."}),"\n",(0,a.jsx)(s.li,{children:"Coordenar estado entre testes paralelos ou sequenciais."}),"\n",(0,a.jsx)(s.li,{children:"Implementar l\xf3gica de setup/teardown entre arquivos."}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"uso-b\xe1sico",children:"Uso B\xe1sico"}),"\n",(0,a.jsx)(s.h3,{id:"1-defina-um-recurso-compartilhado",children:"1. Defina um Recurso Compartilhado"}),"\n",(0,a.jsxs)(s.p,{children:["Crie um arquivo ",(0,a.jsx)(s.code,{children:".resource.ts"})," e exporte um recurso compartilhado usando ",(0,a.jsx)(s.code,{children:"createSharedResource"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { createSharedResource } from 'poku';\n\nexport default createSharedResource('sharedCounter', () => {\n  let count = 0;\n  return {\n    getCount: () => count,\n    increment: () => ++count,\n    reset: () => {\n      count = 0;\n    },\n  };\n});\n"})}),"\n",(0,a.jsx)(s.h3,{id:"2-acesse-o-recurso-compartilhado-nos-testes",children:"2. Acesse o Recurso Compartilhado nos Testes"}),"\n",(0,a.jsxs)(s.p,{children:["Use ",(0,a.jsx)(s.code,{children:"getSharedResource"})," em qualquer arquivo de teste para acessar e chamar m\xe9todos do recurso compartilhado:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { getSharedResource, test, assert } from 'poku';\n\ntest('incrementa o contador', async () => {\n  const [counter, detach] = await getSharedResource('sharedCounter');\n  await counter.increment();\n  assert.equal(await counter.getCount(), 1);\n  detach();\n});\n"})}),"\n",(0,a.jsx)(s.h3,{id:"3-m\xe9todos-se-tornam-chamadas-de-procedimento-remoto",children:"3. M\xe9todos se Tornam Chamadas de Procedimento Remoto"}),"\n",(0,a.jsx)(s.p,{children:"Todas as fun\xe7\xf5es do seu recurso se tornam chamadas de procedimento remoto (RPCs), ent\xe3o voc\xea pode alterar ou ler o estado compartilhado com seguran\xe7a entre processos."}),"\n",(0,a.jsxs)(s.p,{children:["\xc9 importante notar que os argumentos s\xe3o serializados usando ",(0,a.jsx)(s.a,{href:"https://nodejs.org/api/child_process.html#advanced-serialization",children:"Advanced Serialization"}),"\ndurante a comunica\xe7\xe3o entre diferentes processos, o que significa que alguns tipos complexos (como fun\xe7\xf5es) n\xe3o s\xe3o suportados neste momento."]}),"\n",(0,a.jsx)(s.h3,{id:"4-desanexando-o-recurso",children:"4. Desanexando o Recurso"}),"\n",(0,a.jsxs)(s.p,{children:["Quando voc\xea chama ",(0,a.jsx)(s.code,{children:"getSharedResource"}),", ele retorna uma tupla com o recurso e uma fun\xe7\xe3o ",(0,a.jsx)(s.code,{children:"detach"}),".\n",(0,a.jsxs)(s.strong,{children:["\xc9 essencial sempre chamar ",(0,a.jsx)(s.code,{children:"detach"})," ao final do seu teste"]}),": isso cancela a inscri\xe7\xe3o do seu processo de teste\nnas atualiza\xe7\xf5es do recurso compartilhado, garantindo a limpeza adequada e prevenindo vazamentos de mem\xf3ria.\nSe voc\xea n\xe3o chamar ",(0,a.jsx)(s.code,{children:"detach"}),", seu processo permanecer\xe1 inscrito, o que pode levar a vazamentos de recursos,\nuso desnecess\xe1rio de mem\xf3ria e problemas de isolamento de testes. Ao sempre chamar ",(0,a.jsx)(s.code,{children:"detach"}),", voc\xea mant\xe9m\nseu ambiente de teste limpo, previs\xedvel e livre de efeitos colaterais causados por inscri\xe7\xf5es remanescentes."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"test('desanexa o recurso', async () => {\n  const [counter, detach] = await getSharedResource('sharedCounter');\n  await counter.increment();\n  assert.equal(await counter.getCount(), 1);\n  detach(); // Limpa o recurso\n});\n"})}),"\n",(0,a.jsx)(s.h3,{id:"5-l\xf3gica-de-limpeza",children:"5. L\xf3gica de Limpeza"}),"\n",(0,a.jsx)(s.p,{children:"Voc\xea pode definir uma fun\xe7\xe3o de limpeza ao criar o recurso. Ela ser\xe1 chamada quando o recurso n\xe3o for mais necess\xe1rio:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"export default createSharedResource(\n  'sharedCounter',\n  () => {\n    let count = 0;\n    return {\n      getCount: () => count,\n      increment: () => ++count,\n      reset: () => {\n        count = 0;\n      },\n    };\n  },\n  (resource) => {\n    // L\xf3gica de limpeza\n    resource.reset();\n  }\n);\n"})}),"\n",(0,a.jsx)(s.h2,{id:"exemplos-do-mundo-real",children:"Exemplos do Mundo Real"}),"\n",(0,a.jsxs)(s.h3,{id:"1-cache-lru-compartilhado-lrumin",children:["1. Cache LRU Compartilhado (",(0,a.jsx)(s.code,{children:"lru.min"}),")"]}),"\n",(0,a.jsx)(s.p,{children:"Compartilhe um cache LRU em mem\xf3ria entre testes:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"lru.resource.ts"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { createSharedResource } from 'poku';\nimport { createLRU } from 'lru.min';\n\nexport default createSharedResource('lru', () => {\n  const cache = createLRU({ max: 3 });\n  return cache;\n});\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"cache.test.ts"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { getSharedResource, test, assert } from 'poku';\n\ntest('pode compartilhar cache', async () => {\n  const [cache, detach] = await getSharedResource('lru');\n  await cache.set('foo', 123);\n  assert((await cache.get('foo')) === 123);\n  detach();\n});\n"})}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.h3,{id:"2-conex\xe3o-mysql-compartilhada-mysql2",children:["2. Conex\xe3o MySQL Compartilhada (",(0,a.jsx)(s.code,{children:"mysql2"}),")"]}),"\n",(0,a.jsx)(s.p,{children:"Compartilhe uma \xfanica conex\xe3o MySQL entre testes:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"mysql.resource.ts"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { createSharedResource } from 'poku';\nimport mysql from 'mysql2/promise';\n\nexport default createSharedResource(\n  'mysql',\n  async () => {\n    const connection = await mysql.createConnection({\n      host: 'localhost',\n      user: 'root',\n      database: 'test',\n    });\n    return connection;\n  },\n  (connection) => {\n    // Fun\xe7\xe3o de limpeza para fechar a conex\xe3o\n    return connection.destroy();\n  }\n);\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"db.test.ts"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { getSharedResource, test, assert } from 'poku';\n\ntest('pode consultar usu\xe1rios', async () => {\n  const [db, detach] = await getSharedResource('mysql');\n  const [rows] = await db.query('SELECT * FROM users LIMIT 10');\n\n  assert(Array.isArray(rows));\n  assert.equal(rows.length, 10);\n  detach();\n});\n"})})]})}function m(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},28453:(e,s,r)=>{r.d(s,{R:()=>t,x:()=>c});var o=r(96540);const a={},n=o.createContext(a);function t(e){const s=o.useContext(n);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),o.createElement(n.Provider,{value:s},e.children)}},38215:(e,s,r)=>{r.d(s,{B:()=>t});var o=r(41622);const a=(0,r(84722).A)("file-clock",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"37hlfg"}],["path",{d:"M8 14v2.2l1.6 1",key:"6m4bie"}],["circle",{cx:"8",cy:"16",r:"6",key:"10v15b"}]]);var n=r(74848);const t=({records:e,open:s})=>(0,n.jsx)(o.A,{open:s,summary:(0,n.jsxs)("summary",{children:[(0,n.jsx)(a,{})," History"]}),className:"history",children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Version"}),(0,n.jsx)("th",{children:"Changes"})]})}),(0,n.jsx)("tbody",{children:e.map((e,s)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("strong",{children:["v",e.version.replace(/^v/,"")]})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"changes",children:e.changes.map((e,s)=>(0,n.jsx)("section",{children:e},`change:${s}`))})})]},`record:${s}`))})]})})},41622:(e,s,r)=>{r.d(s,{A:()=>x});var o=r(96540),a=r(34164),n=r(63427),t=r(92303),c=r(41422);const i={details:"details_lb9f",isBrowser:"isBrowser_bmU9",collapsibleContent:"collapsibleContent_i85q"};var d=r(74848);function l(e){return!!e&&("SUMMARY"===e.tagName||l(e.parentElement))}function h(e,s){return!!e&&(e===s||h(e.parentElement,s))}function u({summary:e,children:s,...r}){(0,n.A)().collectAnchor(r.id);const u=(0,t.A)(),m=(0,o.useRef)(null),{collapsed:p,setCollapsed:x}=(0,c.u)({initialState:!r.open}),[j,g]=(0,o.useState)(r.open),v=o.isValidElement(e)?e:(0,d.jsx)("summary",{children:e??"Details"});return(0,d.jsxs)("details",{...r,ref:m,open:j,"data-collapsed":p,className:(0,a.A)(i.details,u&&i.isBrowser,r.className),onMouseDown:e=>{l(e.target)&&e.detail>1&&e.preventDefault()},onClick:e=>{e.stopPropagation();const s=e.target;l(s)&&h(s,m.current)&&(e.preventDefault(),p?(x(!1),g(!0)):x(!0))},children:[v,(0,d.jsx)(c.N,{lazy:!1,collapsed:p,onCollapseTransitionEnd:e=>{x(e),g(!e)},children:(0,d.jsx)("div",{className:i.collapsibleContent,children:s})})]})}const m={details:"details_b_Ee"},p="alert alert--info";function x({...e}){return(0,d.jsx)(u,{...e,className:(0,a.A)(p,m.details,e.className)})}},42467:(e,s,r)=>{r.d(s,{k:()=>h});var o=r(84722);const a=(0,o.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),n=(0,o.A)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),t=(0,o.A)("microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]),c=(0,o.A)("package-search",[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["circle",{cx:"18.5",cy:"15.5",r:"2.5",key:"b5zd12"}],["path",{d:"M20.27 17.27 22 19",key:"1l4muz"}]]),i=(0,o.A)("package-check",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),d=(0,o.A)("lightbulb-off",[["path",{d:"M16.8 11.2c.8-.9 1.2-2 1.2-3.2a6 6 0 0 0-9.3-5",key:"1fkcox"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M6.3 6.3a4.67 4.67 0 0 0 1.2 5.2c.7.7 1.3 1.5 1.5 2.5",key:"10m8kw"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);var l=r(74848);const h=({level:e,message:s})=>{const r={0:{title:"Deprecated",icon:(0,l.jsx)(a,{})},1:{title:"Experimental",icon:(0,l.jsx)(n,{})},1.1:{title:"Early Development",icon:(0,l.jsx)(t,{})},1.2:{title:"Release Candidate",icon:(0,l.jsx)(c,{})},2:{title:"Stable",icon:(0,l.jsx)(i,{})},3:{title:"Legacy",icon:(0,l.jsx)(d,{})}};return(0,l.jsxs)("section",{className:"stability","data-level":e,children:[(0,l.jsxs)("header",{children:[(0,l.jsx)("strong",{children:e}),(0,l.jsx)("span",{children:r[e].title}),r[e].icon]}),s?(0,l.jsx)("p",{children:s}):null]})}},84722:(e,s,r)=>{r.d(s,{A:()=>d});var o=r(96540);const a=e=>{const s=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,r)=>r?r.toUpperCase():s.toLowerCase()))(e);return s.charAt(0).toUpperCase()+s.slice(1)},n=(...e)=>e.filter((e,s,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===s).join(" ").trim(),t=e=>{for(const s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const i=(0,o.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:i="",children:d,iconNode:l,...h},u)=>(0,o.createElement)("svg",{ref:u,...c,width:s,height:s,stroke:e,strokeWidth:a?24*Number(r)/Number(s):r,className:n("lucide",i),...!d&&!t(h)&&{"aria-hidden":"true"},...h},[...l.map(([e,s])=>(0,o.createElement)(e,s)),...Array.isArray(d)?d:[d]])),d=(e,s)=>{const r=(0,o.forwardRef)(({className:r,...t},c)=>{return(0,o.createElement)(i,{ref:c,iconNode:s,className:n(`lucide-${d=a(e),d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...t});var d});return r.displayName=a(e),r}}}]);