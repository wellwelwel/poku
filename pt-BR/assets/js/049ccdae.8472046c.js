"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9840],{12566:(e,n,t)=>{t.d(n,{T:()=>r});var s=t(41622),o=t(74848);const r=({children:e,open:n,title:t})=>(0,o.jsx)(s.A,{open:n,className:"faq",summary:(0,o.jsx)("summary",{children:(0,o.jsx)("strong",{children:t})}),children:(0,o.jsx)("section",{children:e})})},27199:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"documentation/helpers/processes/wait-for-expected-result","title":"Aguardando por Resultados Esperados","description":"Semelhante ao assert, mas em vez de retornar um erro na compara\xe7\xe3o, ele tentar\xe1 novamente at\xe9 obter sucesso ou exceder o tempo limite.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/documentation/helpers/processes/wait-for-expected-result.mdx","sourceDirName":"documentation/helpers/processes","slug":"/documentation/helpers/processes/wait-for-expected-result","permalink":"/pt-BR/docs/documentation/helpers/processes/wait-for-expected-result","draft":false,"unlisted":false,"editUrl":"https://github.com/wellwelwel/poku/tree/main/website/docs/documentation/helpers/processes/wait-for-expected-result.mdx","tags":[{"inline":true,"label":"flakey","permalink":"/pt-BR/docs/tags/flakey"},{"inline":true,"label":"containers","permalink":"/pt-BR/docs/tags/containers"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["flakey","containers"]},"sidebar":"docs","previous":{"title":"Aguardando Portas","permalink":"/pt-BR/docs/documentation/helpers/processes/wait-for-port"},"next":{"title":"Buscando PIDs","permalink":"/pt-BR/docs/documentation/helpers/processes/get-pids"}}');var o=t(74848),r=t(28453),a=t(12566);const i={sidebar_position:3,tags:["flakey","containers"]},c="Aguardando por Resultados Esperados",d={},l=[{value:"waitForExpectedResult",id:"waitforexpectedresult",level:2},{value:"Exemplos",id:"exemplos",level:2}];function u(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"aguardando-por-resultados-esperados",children:"Aguardando por Resultados Esperados"})}),"\n",(0,o.jsxs)(n.p,{children:["Semelhante ao ",(0,o.jsx)(n.code,{children:"assert"}),", mas em vez de retornar um erro na compara\xe7\xe3o, ele tentar\xe1 novamente at\xe9 obter sucesso ou exceder o tempo limite."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Espera at\xe9 que conex\xf5es, servi\xe7os externos estejam prontos ou que um resultado espec\xedfico de um m\xe9todo esteja dispon\xedvel antes de iniciar os testes."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"waitforexpectedresult",children:"waitForExpectedResult"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { waitForExpectedResult } from 'poku';\n\nawait waitForExpectedResult(() => true, true, {\n  delay: 0,\n  interval: 100,\n  timeout: 60000,\n  strict: false,\n});\n"})}),"\n",(0,o.jsx)("hr",{}),"\n",(0,o.jsx)(a.T,{title:"Options",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"export type WaitForExpectedResultOptions = {\n  /**\n   * Intervalo de repeti\xe7\xe3o em milissegundos\n   *\n   * ---\n   *\n   * @default 100\n   */\n  interval?: number;\n  /**\n   * Tempo limite em milissegundos\n   *\n   * ---\n   *\n   * @default 60000\n   */\n  timeout?: number;\n  /**\n   * Atrasa o in\xedcio e o fim pelo n\xfamero definido de milissegundos.\n   *\n   * ---\n   *\n   * @default 0\n   */\n  delay?: number;\n  /**\n   * Garante compara\xe7\xf5es estritas.\n   *\n   * - Para usu\xe1rios do **Bun**, essa op\xe7\xe3o n\xe3o \xe9 necess\xe1ria.\n   *\n   * ---\n   *\n   * @default false\n   */\n  strict?: boolean;\n};\n"})})}),"\n",(0,o.jsx)("hr",{}),"\n",(0,o.jsx)(n.h2,{id:"exemplos",children:"Exemplos"}),"\n",(0,o.jsxs)(n.p,{children:["Aguardando at\xe9 a conex\xe3o com o banco de dados retornar ",(0,o.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { waitForExpectedResult } from 'poku';\nimport { db } from './db.js';\n\nawait waitForExpectedResult(() => db.connect(), true);\n// await waitForExpectedResult(async () => await db.connect(), true);\n"})}),"\n",(0,o.jsx)("hr",{}),"\n",(0,o.jsx)(n.p,{children:"Aguardando at\xe9 que a conex\xe3o com o banco de dados n\xe3o lance uma exce\xe7\xe3o:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { waitForExpectedResult } from 'poku';\nimport { db } from './db.js';\n\nawait waitForExpectedResult(async () => {\n  try {\n    await db.connect();\n    return true;\n  } catch {}\n}, true);\n"})}),"\n",(0,o.jsx)("hr",{}),"\n",(0,o.jsx)(n.p,{children:"Aguardando por uma conex\xe3o com o banco de dados de um cont\xeainer antes de executar toda a su\xedte de testes e parando o cont\xeainer ao finalizar:"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Exemplo de ",(0,o.jsx)(n.em,{children:"API"})," do ",(0,o.jsx)(n.strong,{children:"Poku"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"import { poku, docker, waitForExpectedResult, exit } from 'poku';\nimport { db } from './db.js';\n\n// Carrega o docker-compose.yml\nconst compose = docker.compose();\n\n// Inicia o cont\xeainer\nawait compose.up();\n\n// Aguardando pelo banco de dados\nawait waitForExpectedResult(async () => {\n  try {\n    await db.connect();\n    return true;\n  } catch {}\n}, true);\n\n// Inicia a su\xedte de testes\nconst result = await poku('./test/integration', {\n  noExit: true,\n});\n\n// Finaliza o cont\xeainer\nawait compose.down();\n\n// Mostra os resultados dos testes e encerra o processo com o c\xf3digo de sa\xedda dos testes.\nexit(result);\n"})}),"\n",(0,o.jsxs)("blockquote",{children:[(0,o.jsx)(n.p,{children:"Ent\xe3o:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"node run.test.js\n"})}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"npx tsx run.test.ts\n"})})]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.a,{href:"/docs/documentation/helpers/containers#dockerfile",children:["Veja um exemplo usando o ",(0,o.jsx)(n.strong,{children:"Dockerfile"}),"."]})})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(96540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},41622:(e,n,t)=>{t.d(n,{A:()=>h});var s=t(96540),o=t(34164),r=t(63427),a=t(92303),i=t(41422);const c={details:"details_lb9f",isBrowser:"isBrowser_bmU9",collapsibleContent:"collapsibleContent_i85q"};var d=t(74848);function l(e){return!!e&&("SUMMARY"===e.tagName||l(e.parentElement))}function u(e,n){return!!e&&(e===n||u(e.parentElement,n))}function p({summary:e,children:n,...t}){(0,r.A)().collectAnchor(t.id);const p=(0,a.A)(),m=(0,s.useRef)(null),{collapsed:x,setCollapsed:h}=(0,i.u)({initialState:!t.open}),[f,j]=(0,s.useState)(t.open),g=s.isValidElement(e)?e:(0,d.jsx)("summary",{children:e??"Details"});return(0,d.jsxs)("details",{...t,ref:m,open:f,"data-collapsed":x,className:(0,o.A)(c.details,p&&c.isBrowser,t.className),onMouseDown:e=>{l(e.target)&&e.detail>1&&e.preventDefault()},onClick:e=>{e.stopPropagation();const n=e.target;l(n)&&u(n,m.current)&&(e.preventDefault(),x?(h(!1),j(!0)):h(!0))},children:[g,(0,d.jsx)(i.N,{lazy:!1,collapsed:x,onCollapseTransitionEnd:e=>{h(e),j(!e)},children:(0,d.jsx)("div",{className:c.collapsibleContent,children:n})})]})}const m={details:"details_b_Ee"},x="alert alert--info";function h({...e}){return(0,d.jsx)(p,{...e,className:(0,o.A)(x,m.details,e.className)})}}}]);