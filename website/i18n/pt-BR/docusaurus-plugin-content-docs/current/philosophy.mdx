import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Filosofia

A filosofia do **Poku** se concentra na simplicidade e na efici√™ncia, removendo complexidades e padr√µes para tornar os testes acess√≠veis desde os projetos mais simples at√© os mais complexos.

<hr />

## Ess√™ncia do JavaScript para testes üí° {#javascript-essence-for-tests-}

> A sintaxe nativa do **JavaScript** para testes √© o que torna poss√≠vel usar o **Poku** em v√°rias plataformas.

Imagine que voc√™ quer executar fun√ß√µes ass√≠ncronas, em que uma √© executada ap√≥s a outra, e exibir uma mensagem no in√≠cio e no final da execu√ß√£o:

```ts
console.log('Iniciado');

await funcA();
await funcB();

console.log('Finalizado');
```

Normalmente, n√£o √© poss√≠vel fazer isso com a maioria dos executores de teste.
Veja este exemplo fict√≠cio:

> Um termo popular para isso √© ‚Äúboilerplate‚Äù, que s√£o requisitos extras para estruturar e configurar os testes.

```ts
describe('Meu Teste', { concurrency: 1 }, () => {
  // Voc√™ precisa declarar explicitamente o que deve ser executado antes dos testes
  beforeAll(() => {
    console.log('Iniciado');
  });

  // A √∫ltima etapa do script √© chamada antes dos pr√≥prios testes
  afterAll(() => {
    console.log('Finalizado');
  });

  // Testes ass√≠ncronos, mas eles ser√£o executados sequencialmente mesmo sem o uso do `await`
  it(async () => {
    // teste ass√≠ncrono
  });

  it(async () => {
    // teste ass√≠ncrono
  });
});
```

Al√©m disso, n√£o √© poss√≠vel execut√°-lo como `node test.js` devido a _evaluations_, estado global ou transforma√ß√µes de testes, sendo necess√°rio rodar seu teste usando o executor de teste.

O **Poku** traz de volta a ess√™ncia do **JavaScript** aos testes:

```ts
import { describe, it } from 'poku';

describe('Meu Teste', async () => {
  console.log('Iniciado');

  await it(async () => {
    // teste ass√≠ncrono
  });

  await it(async () => {
    // teste ass√≠ncrono
  });

  console.log('Finalizado');
});
```

:::tip

O **Poku** n√£o utiliza um estado global, permitindo que voc√™ o use como e onde quiser:

<Tabs>
  <TabItem default value='Node.js + Poku'>

```bash
npx poku test.js
```

  </TabItem>
  <TabItem default value='Bun + Poku'>

```bash
bun poku test.js
```

  </TabItem>
  <TabItem default value='Deno + Poku'>

```bash
deno run npm:poku test.js
```

  </TabItem>
  <TabItem default value='Node.js'>

```bash
node test.js
```

  </TabItem>
  <TabItem default value='Bun'>

```bash
bun test.js
```

  </TabItem>
  <TabItem default value='Deno'>

```bash
deno run test.js
```

  </TabItem>
  <TabItem default value='Yarn + Poku'>

```bash
yarn poku test.js
```

  </TabItem>
  <TabItem default value='pnpm + Poku'>

```bash
pnpm poku test.js
```

  </TabItem>
</Tabs>

- A mesma ideia para o **TypeScript**.

:::

<hr />

## Tornando os testes realmente f√°ceis üå±

Em muitos casos, os testes levam ao mesmo objetivo comum: a verifica√ß√£o de um valor esperado com um valor din√¢mico.

Mas os testes geralmente n√£o mostram logs e detalhes suficientes se voc√™ se concentrar apenas na verifica√ß√£o de valores. Mesmo que funcionem, voc√™ pode facilmente encontrar uma mensagem de erro como "pelo menos um teste √© necess√°rio" com alguns executores de testes.

Um exemplo usando o `assert` nativo do **Node.js**:

```ts
import assert from 'node:assert';

const one = 1;
assert.equal(one, 1, '1 precisa ser igual a 1');
```

- A mensagem neste exemplo n√£o ser√° exibida e o teste passar√° silenciosamente.

Em vez disso, voc√™ precisar√° usar `test` ou `describe` e `it`:

```ts
import assert from 'node:assert';
import test from 'node:test';

test('one √© igual a 1', () => {
  const one = 1;
  assert.equal(one, 1, '1 precisa ser igual a 1');
});
```

O **Poku** permite que um teste siga a abordagem **BDD**/**TDD** usando apenas o m√©todo `assert`:

> ‚ö†Ô∏è _Por favor, isso n√£o √© uma recomenda√ß√£o, mas sim, seria poss√≠vel para testes mais simples._

<Tabs>
  <TabItem default value='test/file.test.mjs'>

```ts
import { assert } from 'poku';

const one = 1;
assert.equal(one, 1, 'one √© igual a 1');
```

  </TabItem>
</Tabs>

Ent√£o:

<Tabs>
  <TabItem default value='Node.js and TypeScript (Node.js)'>

```bash
npx poku
```

  </TabItem>
  <TabItem  value='Bun'>

```bash
bun poku
```

  </TabItem>
  <TabItem  value='Deno'>

```bash
deno run npm:poku
```

  </TabItem>
</Tabs>

:::info
Isso ir√° gerar um log completo, tanto em caso de sucesso quanto de falha, mantendo o estilo exato de desenvolvimento do **Node.js** e sendo compat√≠vel com **Node.js**, **Bun** e **Deno**.
:::

:::tip
Cada caso pode ser diferente. Para isso, o **Poku** possui uma forma completamente modular de uso, permitindo que voc√™ utilize `test`, `describe`, `it`, `beforeEach`, `afterEach`, o modo `--watch` e mais, de acordo com suas necessidades para testes mais complexos ou testes que seguem um padr√£o espec√≠fico.
:::

<hr />

## Funcionalidades especiais üí´

O **Poku** oferece suporte integrado para desafios comuns de teste, como iniciar servi√ßos, servidores e cont√™ineres necess√°rios para executar testes e encerr√°-los no final dos testes, al√©m de flexibilidade para lidar com portas e processos.

<hr />

## Prioridades de desenvolvimento üîß

- Uso amig√°vel para humanos.
- Compatibilidade entre plataformas (**Node**, **Bun**, e **Deno**).
- Melhorias no desempenho.
- Todas as funcionalidades devem ser documentadas e ter pelo menos um exemplo m√≠nimo de uso.

> Compatibilidade com ambientes legados sempre que poss√≠vel, documentando quando um recurso espec√≠fico funciona apenas a partir de uma vers√£o do runtime/plataforma.

<hr />

## Por que n√£o instalar depend√™ncias externas? üì¶

> Por ordem de relev√¢ncia

1. Exigindo que todas as depend√™ncias poss√≠veis sejam totalmente compat√≠veis com **Node.js**, **Bun** e **Deno**.
2. Para manter o tamanho final da instala√ß√£o o mais leve poss√≠vel.
3. Para evitar problemas de compatibilidade com ambientes legados.

### TypeScript

Para **Node.js** + **TypeScript**, o Poku usa [**tsx**](https://github.com/privatenumber/tsx) para executar os arquivos.
Por que? Porque segue o mesmo princ√≠pio do **Poku**: zero configura√ß√µes para necessidades comuns.

<hr />

## Por que manter a compatibilidade com vers√µes anteriores? üë¥üèº

> Esse t√≥pico n√£o se refere ao **Bun** e ao **Deno**.

V√°rios projetos ainda utilizam ou oferecem suporte a vers√µes legadas. O requisito para vers√µes legadas n√£o √© uma regra r√≠gida e pode mudar com as vers√µes major devido a recursos espec√≠ficos que podem exigir polyfills e afetar diretamente o desempenho.

Por isso, o limite escolhido foi a vers√£o `12.x.x` do **Node.js**.

### Polyfills atuais

- `fs`: Transformar m√©todos de callback em promises
- `Object`: `entries` e `fromEntries` (usado somente quando n√£o estiver dispon√≠vel nativamente)
- Suporte para execu√ß√µes diretas do **CommonJS** no **Deno**

:::note
**Poku** sempre recomenda o uso de vers√µes compat√≠veis de cada runtime.
:::

<hr />

## Planos futuros üìÜ

Embora n√£o seja uma prioridade, h√° planos para integrar os seguintes recursos ao **Poku**:

- **Stub**
- **Mock**
- **Spies**

> Veja exemplos de **mock** para [**CJS**](/docs/examples/mock/cjs) e [**ESM**](/docs/examples/mock/esm) usando **Poku** + [**quibble**](https://github.com/testdouble/quibble).

<hr />

## Controle de vers√£o üè∑Ô∏è

Elas n√£o s√£o consideradas breaking changes:

- Altera√ß√µes de formata√ß√£o e estilo nos resultados.
- Novas funcionalidades que dependem de uma vers√£o espec√≠fica da plataforma.
- Se um recurso n√£o for mais √∫til devido a uma nova abordagem.
- Altera√ß√µes no schema do intellisense do _JSON_ _(arquivos de configura√ß√£o)_.

<hr />

## O que o Poku n√£o se prop√µe a ser ü§öüèª

- Um substituto para executores de teste nativos
  - Tente usar o **Poku** como uma alternativa üê∑
- O mais leve ou o mais r√°pido
  - Embora esses pontos sejam considerados, o principal objetivo √© manter um equil√≠brio entre boas pr√°ticas.

:::danger
Observe que o **Poku** tem uma maneira diferente de ser usado, inspirada inteiramente na ess√™ncia do JavaScript nativo, o que pode ser tanto uma vantagem quanto uma desvantagem para aqueles que est√£o acostumados com os _hooks_ tradicionais de outros executores de teste.
:::
