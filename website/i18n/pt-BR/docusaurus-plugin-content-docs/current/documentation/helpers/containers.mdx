---
sidebar_position: 6
tags: [containers]
---

import { FAQ } from '@site/src/components/FAQ';
import { History } from '@site/src/components/History';

# ğŸ³ ContÃªineres

<History
  records={[
    {
      version: '3.0.3-canary.86e2832e',
      changes: [
        <>
          Migrate <strong>Docker</strong> functionality to a{' '}
          <a href='https://github.com/pokujs/docker'>dedicated package</a>.
        </>,
      ],
    },
  ]}
/>

Uma API mÃ­nima para auxiliar testes que requerem contÃªineres ou testes que sÃ£o executados dentro de contÃªineres.

> Esse auxiliar pressupÃµe que vocÃª jÃ¡ tem uma compreensÃ£o bÃ¡sica de como o **Docker** funciona.

## Install

```sh
npm i -D @pokujs/docker
```

## Usage

### Docker Compose

Inicie contÃªineres a partir de um **docker-compose.yml** em segundo plano.

```ts
import { docker } from '@pokujs/docker';

const compose = docker.compose();

// Inicia o(s) contÃªiner(es)
await compose.up();

/**
 * Testes vÃªm aqui ğŸ§ª
 */

// Interrompe o(s) contÃªiner(es)
await compose.down();
```

<FAQ title='Options' >

```ts
export type DockerComposeConfigs = {
  /**
   * Especifica o caminho do **docker-compose.yml**
   *
   * ---
   *
   * @default "./docker-compose.yml"
   */
  file?: string;

  /**
   * Especifica o nome do projeto.
   */
  projectName?: string;

  /**
   * Especifica um caminho `.env` para o **docker-compose.yml**.
   */
  envFile?: string;

  /**
   * Define o diretÃ³rio raiz onde o processo irÃ¡ rodar.
   *
   * ---
   *
   * @default "."
   */
  cwd?: string;

  /**
   * ForÃ§a a reconstruÃ§Ã£o das imagens (**Dockerfile**).
   */
  build?: boolean;

  /**
   * Inicia apenas um serviÃ§o especÃ­fico do **docker-compose.yml**.
   */
  serviceName?: string;

  /**
   * NÃ£o executa o contÃªiner em segundo plano e retorna o resultado de saÃ­da do processo do contÃªiner (boolean).
   *
   * - Defina como `false` para testar se um contÃªiner foi executado e finalizado com sucesso.
   *
   * ---
   *
   * @default true
   */
  detach?: boolean;

  /**
   * Mostra logs do **Docker** em tempo real.
   */
  verbose?: boolean;
};
```

</FAQ>

<hr />

### Dockerfile

ConstrÃ³i e inicia contÃªineres a partir de **Dockerfiles** em segundo plano.

```ts
import { docker } from '@pokujs/docker';

const dockerfile = docker.dockerfile({
  containerName: 'nome-do-contÃªiner',
  tagName: 'nome-da-imagem',
});

// ConstrÃ³i a imagem a partir do Dockerfile
await dockerfile.build();

// Inicia o contÃªiner
await dockerfile.start();

/**
 * Testes vÃªm aqui ğŸ§ª
 */

// Interrompe e remove tanto o contÃªiner quanto a imagem
await dockerfile.remove();
```

- VocÃª tambÃ©m pode usar `.stop()` para interromper o contÃªiner de maneira suave sem removÃª-lo.

<FAQ title='Options'>

```ts
export type DockerfileConfigs = {
  /**
   * Especifica o nome da imagem
   *
   * Por exemplo, `"nome"`, `"nome:tag"`.
   */
  tagName: string;

  /**
   * Especifica o nome do contÃªiner.
   */
  containerName: string;

  /**
   * Especifica o caminho do **Dockerfile**
   *
   * ---
   *
   * @default "./Dockerfile"
   */
  file?: string;

  /**
   * Especifica o caminho de contexto do **Dockerfile**
   *
   * - Ã‰ diferente do `cwd`.
   *
   * ---
   *
   * @default "."
   */
  context?: string;

  /**
   * Especifica as portas a serem expostas.
   *
   * Por exemplo, `"6000:6000"`, `"8080:80"`, `"127.0.0.1:3306:3306"`.
   */
  ports?: string[];

  /**
   * Especifica as variÃ¡veis de ambiente do contÃªiner.
   *
   * Por exemplo, `"VAR1"`, `"VAR1=value1"`
   */
  environments?: string[];

  /**
   * Especifica um caminho para o arquivo `.env` no **Dockerfile**.
   */
  envFile?: string;

  /**
   * ForÃ§a a construÃ§Ã£o da imagem sem cache.
   */
  cache?: boolean;

  /**
   * NÃ£o executa o contÃªiner em segundo plano e retorna o resultado de saÃ­da do processo do contÃªiner (boolean).
   *
   * - Defina como `false` para testar se um contÃªiner foi executado e finalizado com sucesso.
   *
   * ---
   *
   * @default true
   */
  detach?: boolean;

  /**
   * Define o diretÃ³rio raiz onde o processo irÃ¡ rodar.
   *
   * ---
   *
   * @default "."
   */
  cwd?: string;

  /**
   * Mostra logs do **Docker** em tempo real.
   */
  verbose?: boolean;
};
```

</FAQ>

<hr />

## Exemplos Reais

Testes realizados dentro de um contÃªiner (**docker-compose.yml**) em um serviÃ§o especÃ­fico com imagens personalizadas (**Dockerfile**), retornando a saÃ­da, interrompendo os contÃªineres e limpando as imagens:

- [test/compatibility/bun-canary.test.ts](https://github.com/wellwelwel/poku/blob/main/test/compatibility/bun-canary.test.ts)

<hr />

Testes realizados dentro de um contÃªiner (**Dockerfile**), retornando a saÃ­da, interrompendo o contÃªiner e limpando a imagem:

- [test/compatibility-by-dockerfile/bun-canary.test.ts](https://github.com/wellwelwel/poku/blob/main/test/compatibility-by-dockerfile/bun-canary.test.ts)

<hr />

Inicia um contÃªiner antes de toda a suÃ­te de testes e o interrompe ao finalizar:

> Exemplo de _API_ do **Poku**.

```ts
import { poku, exit } from 'poku';
import { docker } from '@pokujs/docker';

const compose = docker.compose({ cwd: './test/docker' });

// Remove o contÃªiner se ele jÃ¡ existir antes de iniciar
await compose.down();

// Inicia o contÃªiner
await compose.up();

const result = await poku('./test/integration', {
  noExit: true,
});

// Interrompe o contÃªiner
await compose.down();

// Mostra os resultados dos testes e finaliza o processo com o cÃ³digo de saÃ­da do teste.
exit(result);
```

```sh
node run.test.mjs
```

<hr />

:::note
Esta nÃ£o Ã© uma _API_ completa e robusta projetada para criar um _ORM_ para **Docker**, mas uma **API** mÃ­nima focada em necessidades comuns de **integraÃ§Ã£o** e **teste de ponta a ponta**.
:::
