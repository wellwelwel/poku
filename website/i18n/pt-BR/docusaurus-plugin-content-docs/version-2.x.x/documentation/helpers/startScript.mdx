---
sidebar_position: 7
tags: [background, server, service, package.json, scripts]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { FAQ } from '@site/src/components/FAQ';
import Success from '@site/static/img/success.svg';

# ğŸ” Start Script

Execute seus scripts do `package.json` em um processo em segundo plano e teste-os ğŸ§‘ğŸ»â€ğŸ”¬

> startScript(caminhoDoArquivo: string, opÃ§Ãµes?: startScriptOptions);

O `startScript` executa um script diretamente do seu `package.json` ou `deno.json` e o mantÃ©m em execuÃ§Ã£o em um processo em segundo plano atÃ© que vocÃª o libere.

<div className='features black'>
  <div className='p'>
    <Success />
    <span>
      Bastante Ãºtil para testar seu
      [**NextJS**](https://github.com/vercel/next.js),
      [**NuxtJS**](https://github.com/nuxt/nuxt),
      [**nodemon**](https://github.com/remy/nodemon) e todos os apps do projeto
      ğŸš€
    </span>
  </div>
  <div className='p'>
    <Success />
    <span>Permite que **cookies** persistam (_ou nÃ£o_) ğŸª</span>
  </div>
  <div className='p'>
    <Success />
    <span>
      O **Poku** permite que vocÃª utilize o cliente HTTP que quiser, como o
      [**Axios**](https://github.com/axios/axios), o fetch nativo e outros âœ¨
    </span>
  </div>
  <div className='p'>
    <Success />
    <span>
      NÃ£o Ã© necessÃ¡rio adicionar plugins externos para algo tÃ£o simples, basta
      executÃ¡-lo como estÃ¡ ğŸŒ±
    </span>
  </div>
  <div className='p'>
    <Success />
    <span>
      Pare de alterar seu cÃ³digo devido Ã s regras do teste, vocÃª criou seu
      cÃ³digo, nÃ£o o **Poku** ğŸ©µ
    </span>
  </div>
</div>

<hr />

[Veja exemplos prÃ¡ticos usando **fetch**, **Axios**, uma **sessÃ£o persistente** e mais](/docs/examples/local-server).

<hr />

## Boas PrÃ¡ticas ğŸ‘®ğŸ½

### âœ… Sinalize o status "pronto"

Quando possÃ­vel, defina uma saÃ­da do console para indicar que o serviÃ§o estÃ¡ pronto. <br />
Isso irÃ¡ permitir que vocÃª evite execuÃ§Ãµes prematuras e vazamentos de porta.

### âœ… Defina um tempo limite

Definindo um tempo limite, vocÃª evita processos indefinidos que nÃ£o concluem nem com sucesso nem com falha.

### âœ… Encerre seu serviÃ§o quando o trabalho estiver concluÃ­do

VocÃª nÃ£o precisa necessariamente encerrar seu serviÃ§o em segundo plano como a Ãºltima linha do teste, se ele nÃ£o estiver mais em uso.

```ts
import { startScript } from 'poku';

const server = await startScript('start', {
  /**
   * Espere pelo "ready" na saÃ­da do console
   */
  startAfter: 'ready',

  /**
   * Por padrÃ£o, o `timeout` Ã© `60000` (1 minuto) tanto para sucesso quanto para falha
   */
  timeout: 60000,
});

await server.end();
```

:::tip

VocÃª pode passar uma porta para `end` para forÃ§ar o tÃ©rmino do subprocesso em segundo plano para o **Bun** e o **Deno**.

â„¹ï¸ Para usar a porta em `end`, vocÃª irÃ¡ precisar do `lsof` para **Unix** ou `netstat` para **Windows**.

:::

:::info
Se vocÃª estiver enfrentando problemas ao usar esse recurso com o **Bun**, consulte [**oven-sh/bun#11055**](https://github.com/oven-sh/bun/issues/11055) ao usar o mÃ©todo `end` passando uma porta ou [**oven-sh/bun#7441**](https://github.com/oven-sh/bun/issues/7441) para subprocessos nÃ£o concluÃ­dos.
:::

<FAQ title='Oh nÃ£o! Eu quebrei, e agora? ğŸ¤¡'>

LiberaÃ§Ã£o de uma porta que estÃ¡ vazando:

```bash
lsof -i :PORT
```

- Substitua `PORT` pelo nÃºmero da porta que vocÃª estÃ¡ investigando.

Em seguida, use o `PID` retornado com o comando `kill`:

```bash
kill -9 PID
```

- Substitua `PID` pelo ID do processo atual que vocÃª encontrou usando o comando `lsof`.

</FAQ>

<hr />

## OpÃ§Ãµes DisponÃ­veis

```ts
type StartScriptOptions = {
  /**
   * - Por padrÃ£o, serÃ¡ resolvido na primeira saÃ­da do console
   * - Definindo uma string: ele aguardarÃ¡ uma string especÃ­fica na saÃ­da do console para resolver
   * - Definindo um nÃºmero: ele aguardarÃ¡ o tempo em milissegundos para resolver
   *
   * ---
   *
   * â„¹ï¸ `startAfter` Ã© sensÃ­vel a maiÃºsculas e minÃºsculas.
   *
   * ---
   *
   * @default undefined
   */
  startAfter?: string | number;
  /**
   * Encerra o serviÃ§o sem sucesso nem falha apÃ³s:
   * @default 60000
   */
  timeout?: number;
  /**
   * Exibe a saÃ­da do serviÃ§o
   */
  verbose?: boolean;
  /**
   * Especifica um caminho de destino para iniciar o processo
   *
   * @default "./"
   */
  cwd?: string | undefined;
  /**
   * Por padrÃ£o, o Poku usarÃ¡ o `npm`. Altere conforme desejar.
   */
  runner?: 'npm' | 'bun' | 'deno' | 'yarn' | 'pnpm';
};

type End = (port?: number | number[]) => Promise<void>;
```
